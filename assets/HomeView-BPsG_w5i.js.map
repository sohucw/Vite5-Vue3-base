{"version":3,"file":"HomeView-BPsG_w5i.js","sources":["../../src/views/PreCode.vue","../../src/views/HomeView.vue"],"sourcesContent":["<template>\n    <div class=\"pre_code\">\n        <div class=\"errdetail\">\n            <pre class=\"errCode\" v-html=\"preLineStartEnd()\"></pre>\n        </div>\n    </div>\n</template>\n<script >\nexport default {\n    name: 'PreCode',\n    props: {\n        orgin: Object\n    },\n    methods: {\n        preLineStartEnd() {\n            // 先获取源码有多少行\n            const transformationLine = this.orgin.source.split('\\n')\n            const len = transformationLine.length - 1\n            const start = this.orgin.line - 3 >= 0 ? this.orgin.line - 3 : 0\n            const end = start + 5 >= len ? len : start + 5 // 最多展示6行\n            const line = this.orgin.line\n            let newLines = []\n            for (var i = start; i <= end; i++) {\n                const content = i + 1 + '.    ' + this.encodeHTML(transformationLine[i])\n                newLines.push(\n                    `<div class='code-line ${i + 1 == line ? 'heightlight' : ''}'>${content}</div>`\n                )\n            }\n            return newLines.join('')\n        },\n        encodeHTML(str) {\n            if (!str || str.length == 0) return ''\n            return str\n                .replace(/&/g, '&#38;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/'/g, '&#39;')\n        }\n    }\n}\n</script>\n\n<style>\n.errCode {\n    padding: 10px;\n    overflow: hidden;\n    font-family: consolas, monospace;\n    word-wrap: normal;\n}\n.code-line {\n    padding: 4px;\n}\n\n.heightlight {\n    color: #fff;\n    background-color: #6c5fc7;\n}\n</style>\n","<template>\n    <div v-if=\"isError\">\n        <pre>\n      {{ js_error.stack }}\n    </pre\n        >\n        <el-collapse v-model=\"activeName\" accordion>\n            <el-collapse-item\n                v-for=\"(item, index) in js_error.stack_frames\"\n                :key=\"index\"\n                :title=\"substrSourceTitle(item.source)\"\n                :name=\"index\"\n            >\n                <el-row :gutter=\"20\">\n                    <el-col :span=\"20\">\n                        <div>{{ item.fileName }}</div>\n                    </el-col>\n                    <el-col :span=\"4\">\n                        <el-button size=\"small\" type=\"primary\" @click=\"oepnDialog(item, index)\"\n                            >映射源码</el-button\n                        >\n                    </el-col>\n                </el-row>\n                <el-col :span=\"20\">\n                  <template v-if=\"item.origin\">\n                    <PreCode v-if=\"item.origin\" :orgin=\"item.origin\"></PreCode>\n                  </template>\n                  <template v-if=\"!item.origin\">\n                    <div >{{item.fileName}}</div>\n                  </template>\n                </el-col>\n            </el-collapse-item>\n        </el-collapse>\n\n    </div>\n    <el-dialog\n      title=\"sourceMap映射\"\n      v-model=\"visible\"\n      width=\"500px\"\n      :before-close=\"handleClose\">\n      <el-tabs v-model=\"activeTabName\">\n        <el-tab-pane label=\"本地上传\" name=\"local\">\n          <el-upload\n            style=\"width: 100%\"\n            class=\"upload-demo\"\n            drag\n            action=\"\"\n            :before-upload=\"sourceMapUpload\">\n            <i class=\"el-icon-upload\"></i>\n            <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n          </el-upload>\n        </el-tab-pane>\n        <el-tab-pane label=\"远程加载\" name=\"request\">远程加载</el-tab-pane>\n    </el-tabs>\n  </el-dialog>\n</template>\n<script setup lang=\"ts\">\nimport sourceMap from 'source-map-js'\nimport { onMounted, reactive, ref } from 'vue';\nimport PreCode from './PreCode.vue'\nconst activeName = ref('1')\nconst activeTabName = ref('1')\nlet isError = ref(false);\nlet visible = ref(false);\nlet js_error = reactive<any>(null);\n\nlet stackFrameObj = {\n  line: 0,\n  cloum: 0,\n  index: 0,\n};\nonMounted(() => {\n    try {\n        let js_error_info = localStorage.getItem('jsErrorList')\n        if (js_error_info) {\n          isError.value = true;\n          js_error = JSON.parse(js_error_info)\n            console.log(js_error)\n        }\n    } catch (err) {\n        console.log(err)\n    }\n})\nconst substrSourceTitle = (str: string) => {\n  return  str.substring(0, 100) + '...'\n}\nconst oepnDialog = (stackFrame: any, index: number) => {\n  stackFrameObj = {\n      line: stackFrame.lineNumber,\n      cloum: stackFrame.columnNumber,\n      index: index,\n  };\n  visible.value= true;\n};\nconst sourceMapUpload =  async (file: any) => {\n    if (file.name.substring(file.name.lastIndexOf('.') + 1) !== 'map') {\n    alert(`请上传.js.map 文件！`);\n      return\n    }\n    const reader = new FileReader()\n    reader.readAsText(file, 'UTF-8')\n    reader.onload = async event => {\n      const look_source = await lookSource(event!.target!.result, stackFrameObj.line, stackFrameObj.cloum)\n      js_error.stack_frames[stackFrameObj.index].origin = look_source\n      visible.value = false;\n    }\n    return false\n}\nconst lookSource = async(source_map: any, line: number, column: number) => {\n  try {\n    const consumer = await new sourceMap.SourceMapConsumer(JSON.parse(source_map));\n    const lookUpRes = consumer.originalPositionFor({\n      line: line,\n      column: column\n    })\n    const source = consumer.sourceContentFor(lookUpRes.source)\n    return {\n      source,\n      column: lookUpRes.column,\n      line: lookUpRes.line\n    }\n  } catch(e) {\n    alert(`未能解析出sourceMap！`);\n    console.log(e);\n    return null\n  }\n}\nconst handleClose = (done: any)=> {\n  done();\n}\n</script>\n"],"names":["_sfc_main","transformationLine","len","start","end","line","newLines","i","content","str","_hoisted_1","_hoisted_2","_hoisted_3","_openBlock","_createElementBlock","_createElementVNode","$options","activeName","ref","activeTabName","isError","visible","js_error","reactive","stackFrameObj","onMounted","js_error_info","err","substrSourceTitle","oepnDialog","stackFrame","index","sourceMapUpload","file","reader","event","look_source","lookSource","source_map","column","consumer","sourceMap","lookUpRes","e","handleClose","done"],"mappings":"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"}